server {
    listen 80;
    client_max_body_size 1G;
    server_name {{ host_names }};

    gzip on;
    gzip_proxied any;
    gzip_http_version 1.0;
    gzip_types
        text/css
        text/javascript
        text/xml
        text/plain
        application/javascript
        application/x-javascript
        application/json;

    keepalive_timeout 5;
    access_log {{ project_path }}/var/log/access.log;
    error_log {{ project_path }}/var/log/error.log;

    rewrite ^/(static/.*) /static/client/$1 last;
    rewrite ^/$ /static/client/index.html last;
    rewrite ^/index.html$ /static/client/index.html last;
    rewrite ^/favicon.ico$ /static/client/favicon.ico last;

    location /static/client/ {
       alias {{ clients_path }}/waterlabel-client-v2/;
       expires 1h;
    }

    location /static/client/static/ {
       alias {{ clients_path }}/waterlabel-client-v2/static/;
       expires max;
    }

    location /static_media/ {
       alias {{ project_path }}/var/static/;
       expires max;
    }

    location /media/ {
       alias {{ project_path }}/var/media/;
       expires 1h;
    }

    location / {
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $http_host;
        proxy_redirect off;
        proxy_pass http://localhost:{{ gunicorn_port}};
    }
}
